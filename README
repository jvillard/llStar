* About LStar

  LStar is an automatic prover for programs written in
  bitcode. Bitcode is the intermediate representation of the LLVM
  compiler framework. LStar attempts to prove individual functions
  correct with respect to memory safety and to their
  specifications. In doing so, it automatically discovers loop
  invariants. Specifications are given in the formalism of separation
  logic by the user.

  LStar is distributed under a 3-clause BSD licences (see LICENSE). It
  is available from

    http://www.cs.ucl.ac.uk/staff/J.Villard/lstar

  and development versions are hosted by bitbucket at

    https://bitbucket.org/jvillard/lstar/


* Requirements and How to Get Them

  Read this section carefully!

  LStar requires OCaml, LLVM 3.1, and z3. Additionally, coreStar is
  required to compile LStar from source. The requirements are detailed
  below, in reverse order of exoticism. LStar has been developped
  under Linux, but other environments might be viable.

  In short, get z3 and set the environment variables as shown below,
  and install LLVM and OCaml.

** coreStar

   coreStar is a symbolic execution engine for separation logic, the
   formal theory underlying LStar. It is *included* in standard
   distributions of LStar, so no action should be required to install
   it. Alternatively, it can be fetched from

     https://github.com/seplogic/corestar

   LStar expects coreStar src/ directory to be under corestar_src/, at
   the same level as its own src/ directory. Simply unpack coreStar
   somewhere and set up a symbolic link inside the LStar directory to
   corestar/src/:

"""
ln -s /where/corestar/is/src /where/lstar/is/corestar_src
"""

** z3

   z3 is an SMT solver used to solve the arithmetic constraints found
   during the proof process. It is called by coreStar indirectly from
   LStar. Due to its closed-source nature, it cannot and is *not*
   included with LStar. However, binaries for Linux and Windows are
   available from

     http://research.microsoft.com/en-us/um/redmond/projects/z3/download.html

   The rest of this document assumes that a working version of z3 is
   installed on the system. Moreover, you have to tell LStar where to
   find z3. This is achieved by setting the following environment
   variables:

"""
# *change* this to wherever z3 is on your system
export JSTAR_SMT_PATH=$HOME/local/bin/z3
# keep this as it is, but do set it somewhere
export JSTAR_SMT_ARGUMENTS="-in -smt2"
"""

   coreStar, and thus LStar, should also work with other SMT
   solvers. See the coreStar documentation if you want to use this
   feature.

** LLVM

   LLVM is an open source compiler framework that uses bitcode as its
   intermediate representation, which, incidentally, is the language
   that LStar takes as input. LStar 1.0 builds and run against LLVM
   version 3.1. LLVM is *not* included in the LStar distribution. The
   preferred way to get it is from your software management, or from

     http://llvm.org/releases/download.html#3.1

   You will need the following, all included in the standard LLVM
   distributions:

   - LLVM dynamic libraries and OCaml bindings to build and run LStar

   - LLVM building tools to compile bitcode files into the equivalent
     binary form that LStar takes as input

   - Optionally, the Clang compiler, available from the same location,
     to compile C (and other languages) files to bitcode

   You may want to set up the "LFLAGS" and "CFLAGS" variables in the
   Makefile of LStar to adjust where the LLVM OCaml libraries are on
   your system. By default, they are set as such:

"""
LFLAGS=-cc,g++,-I,/usr/lib/ocaml/llvm-3.1,-cclib,-lffi
CFLAGS=-I,/usr/lib/ocaml/llvm-3.1
"""

** OCaml

   OCaml is a functional language. You can get it from
     http://caml.inria.fr/download.en.html

   LStar has been tested against OCaml 3.12.1. I do not know which minimal
   version is required to compile or run LStar.


* Build Instructions

  Simply go to the LStar directory and type make. This should produce
  the LStar binary at bin/lstar. If not, maybe read the "requirements" section
  above a second time. I hope this works for you!


* Usage

  LStar can be invoked from the command line as follows:

  ./bin/lstar -l <logic_file_name>
              -a <abstraction_file_name>
              -s <spec_file_name>
              -f <bitcode_module>

  The meaning of each option is as follows:

  - <bitcode_module> should be the .bc file you want to analyse.

  - <spec_file_name> is the file that contains specifications for each
    function in the bitcode module above. Specs are given as "f:
    {pre}{post}" where "f" is the name of the function, "pre" its
    intended precondition, and "post" its intended postcondition. See
    the examples included in the distribution for examples of the
    syntax (examples/*/*.spec).

  - <logic_file_name> is a file containing what logical rules LStar
    should use to manipulate symbolic states. A first guess can be to
    use the default file provided in the distribution, and located at
    "logic/llvm.logic". Other logic sample files are included in
    "logic/", including some rudimentary support for arithmetic in
    case there isn't an SMT solver available.

  - <abstraction_file_name> is a file containing abstraction rules
    that LStar uses to approximate the symbolic state when trying to
    find loop invariants. See the "abs/" directory for examples
    (currently, only singly-linked lists).

  It's easier to start from the examples included in the distribution.


* Examples Included in the Distribution

  A few examples are shipped with LStar, under "examples/". Each
  example comes in its own subdirectory, that contains the spec,
  logic, abstraction, and source files, with the addition of a
  Makefile that runs LStar with the appropriate options. See each
  example and its Makefile for details.

  For instance, to run LStar on the Smaug example, that traverses a
  singly-linked list, simply type
"""
cd examples/smaug
make test
"""

  Other examples include Norbert, a program that allocates a struct
  node and fills in its fields with the values passed as argument, and
  "structs", that performs complex field manipulations and pointer
  arithmetic. All the examples are successfully checked by LStar.

  You can run all the tests from the top level directory by doing
"""
make test
"""


                    === Happy Proving! ===
